<?xml version="1.0" encoding="UTF-8"?>

<!--
    _________        _____ __________________        _____
    __  ____/___________(_)______  /__  ____/______ ____(_)_______
    _  / __  __  ___/__  / _  __  / _  / __  _  __ `/__  / __  __ \
    / /_/ /  _  /    _  /  / /_/ /  / /_/ /  / /_/ / _  /  _  / / /
    \____/   /_/     /_/   \_,__/   \____/   \__,_/  /_/   /_/ /_/

    @xml.file.header
    Version: @xml.file.version
-->

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                           http://www.springframework.org/schema/beans/spring-beans-2.5.xsd">
    <description>Main Spring file for grid configuration.</description>

    <bean id="grid.cfg" class="org.gridgain.grid.GridConfiguration" scope="singleton">
        <!-- Specify list of GGFS configurations here. -->
        <property name="ggfsConfiguration">
            <list>
                <bean class="org.gridgain.grid.ggfs.GridGgfsConfiguration">
                    <property name="name" value="ggfs"/>

                    <property name="metaCacheName" value="ggfs-meta"/>

                    <property name="dataCacheName" value="ggfs-data"/>

                    <!-- Must correlate with cache affinity mapper. -->
                    <property name="blockSize" value="#{128 * 1024}"/>
                    <property name="perNodeBatchSize" value="512"/>
                    <property name="perNodeParallelBatchCount" value="16"/>

                    <!-- Set number of prefetch blocks. -->
                    <property name="prefetchBlocks" value="32"/>

                    <!--
                        This will disable IPC endpoint binding thus preventing Hadoop clients from connecting to GGFS.
                        With this option set to false the only possible way to interact with GGFS is through
                        GridGain API.
                    -->
                    <property name="ipcEndpointEnabled" value="false" />
                </bean>
            </list>
        </property>

        <!--
            Specify list of cache configurations here. The following caches are configured:

            - GGFS data cache (PARTITIONED)
            - GGFS meta cache (REPLICATED)

            Any property from GridCacheConfiguration interface can be configured here.
            Note that absolutely all configuration properties are optional.
        -->
        <property name="cacheConfiguration">
            <list>
                <!-- GGFS data cache. -->
                <bean class="org.gridgain.grid.cache.GridCacheConfiguration">
                    <property name="name" value="ggfs-data"/>
                    <property name="cacheMode" value="PARTITIONED"/>
                    <property name="atomicityMode" value="TRANSACTIONAL"/>
                    <property name="writeSynchronizationMode" value="FULL_SYNC"/>
                    <property name="affinityMapper">
                        <bean class="org.gridgain.grid.ggfs.GridGgfsGroupDataBlocksKeyMapper">
                            <constructor-arg value="512"/>
                        </bean>
                    </property>
                </bean>

                <!-- GGFS meta cache. -->
                <bean class="org.gridgain.grid.cache.GridCacheConfiguration">
                    <property name="name" value="ggfs-meta"/>
                    <property name="cacheMode" value="REPLICATED"/>
                    <property name="atomicityMode" value="TRANSACTIONAL"/>
                    <property name="writeSynchronizationMode" value="FULL_SYNC"/>
                </bean>
            </list>
        </property>
    </bean>
</beans>
